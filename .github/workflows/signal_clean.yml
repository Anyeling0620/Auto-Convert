name: Signal Clean Input

# ç›‘å¬è§„åˆ™ï¼šåªæœ‰å½“ empty æ–‡ä»¶å¤¹å†…çš„æ–‡ä»¶å‘ç”Ÿå˜åŒ–æ—¶è§¦å‘
on:
  push:
    paths:
      - 'empty/**'

jobs:
  clean-input:
    runs-on: ubuntu-latest
    permissions:
      contents: write # éœ€è¦å†™æƒé™æ¥æäº¤åˆ é™¤æ“ä½œ

    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Configure Git User
        run: |
          git config --global user.name "Cleaner-Bot"
          git config --global user.email "bot@cleaner.com"

      - name: Execute Cleaning
        run: |
          echo "ğŸš¨ æ£€æµ‹åˆ° 'empty' æ–‡ä»¶å¤¹å˜åŠ¨ï¼Œå¯åŠ¨æ¸…ç†ç¨‹åº..."
          
          # 1. ã€å…³é”®ã€‘å…ˆä» Git ç´¢å¼•å’Œç‰©ç†è·¯å¾„ä¸­å½»åº•ç§»é™¤ input æ–‡ä»¶å¤¹
          # (åŠ ä¸Š || true é˜²æ­¢æ–‡ä»¶å¤¹æœ¬æ¥å°±ä¸å­˜åœ¨æ—¶æŠ¥é”™)
          git rm -r --cached input --ignore-unmatch || true
          rm -rf input || true
          
          # 2. ã€å…³é”®ã€‘é‡æ–°åˆ›å»º input æ–‡ä»¶å¤¹ (è¿™ä¸€æ­¥å¿…é¡»åœ¨ rm ä¹‹åï¼)
          mkdir -p input
          
          # 3. åˆ›å»º .gitkeep å ä½ç¬¦
          touch input/.gitkeep
          
          # 4. é‡æ–°å°† .gitkeep åŠ å…¥æš‚å­˜åŒº
          git add input/.gitkeep
          
          echo "âœ… input ç›®å½•å·²é‡ç½®ï¼Œä»…ä¿ç•™ .gitkeep"

      - name: Commit and Push
        run: |
          # æ£€æŸ¥æ˜¯å¦æœ‰ä¸œè¥¿éœ€è¦æäº¤ (é¿å…ç©ºæäº¤æŠ¥é”™)
          if git diff --cached --quiet; then
            echo "æ— éœ€å˜æ›´ (inputæœ¬æ¥å°±æ˜¯ç©ºçš„)"
          else
            git commit -m "Auto-Clean: Reset input directory by signal"
            
            # æ¨é€åˆ°è§¦å‘è¯¥ Action çš„åˆ†æ”¯ (æ— è®ºæ˜¯ main è¿˜æ˜¯ med/cs)
            git push origin ${{ github.ref_name }}
            echo "ğŸš€ æ¸…ç†ç»“æœå·²æ¨é€è‡³ ${{ github.ref_name }} åˆ†æ”¯"
          fi
