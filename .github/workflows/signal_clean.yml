name: Signal Clean Input

# ç›‘å¬è§„åˆ™ï¼šåªæœ‰å½“ empty æ–‡ä»¶å¤¹å†…çš„æ–‡ä»¶å‘ç”Ÿå˜åŒ–æ—¶è§¦å‘
on:
  push:
    paths:
      - 'empty/**'

jobs:
  clean-input:
    runs-on: ubuntu-latest
    permissions:
      contents: write # éœ€è¦å†™æƒé™æ¥æäº¤åˆ é™¤æ“ä½œ

    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Configure Git User
        run: |
          git config --global user.name "Cleaner-Bot"
          git config --global user.email "bot@cleaner.com"

      - name: Execute Cleaning
        run: |
          echo "ğŸš¨ æ£€æµ‹åˆ° 'empty' æ–‡ä»¶å¤¹å˜åŠ¨ï¼Œå¯åŠ¨æ¸…ç†ç¨‹åº..."
          
          # 1. ç¡®ä¿ input æ–‡ä»¶å¤¹å­˜åœ¨ (é˜²æ­¢æ„å¤–æŠ¥é”™)
          mkdir -p input
          
          # 2. æš´åŠ›æ¸…ç©º input ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ (Git å±‚é¢åˆ é™¤)
          # --ignore-unmatch é˜²æ­¢æ–‡ä»¶å¤¹æœ¬æ¥å°±æ˜¯ç©ºçš„å¯¼è‡´æŠ¥é”™
          git rm -rf input/* --ignore-unmatch
          
          # 3. é‡æ–°åˆ›å»º .gitkeep å ä½ç¬¦ (å¤æ´»)
          touch input/.gitkeep
          
          # 4. å°† .gitkeep åŠ å…¥æš‚å­˜åŒº
          git add input/.gitkeep
          
          echo "âœ… input ç›®å½•å·²é‡ç½®ï¼Œä»…ä¿ç•™ .gitkeep"

      - name: Commit and Push
        run: |
          # æ£€æŸ¥æ˜¯å¦æœ‰ä¸œè¥¿éœ€è¦æäº¤ (é¿å…ç©ºæäº¤æŠ¥é”™)
          if git diff --cached --quiet; then
            echo "æ— éœ€å˜æ›´ (inputæœ¬æ¥å°±æ˜¯ç©ºçš„)"
          else
            git commit -m "Auto-Clean: Reset input directory by signal"
            
            # æ¨é€åˆ°è§¦å‘è¯¥ Action çš„åˆ†æ”¯ (æ— è®ºæ˜¯ main è¿˜æ˜¯ med/cs)
            git push origin ${{ github.ref_name }}
            echo "ğŸš€ æ¸…ç†ç»“æœå·²æ¨é€è‡³ ${{ github.ref_name }} åˆ†æ”¯"
          fi